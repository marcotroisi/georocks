var GeoLoc=function(){var _this=this;var onSuccess="";var onError="";var html5options="";var fallbackToIp="";this.getCurPos=function(successCallback,errorCallback,fallback,html5opt){onSuccess=successCallback;onError=errorCallback||"";fallbackToIp=fallback||false;html5options=html5opt||{};navigator.geolocation.getCurrentPosition(this.geoSuccess,this.geoError,html5options)};this.geoSuccess=function(position){onSuccess(position)};this.geoError=function(error){if(fallbackToIp===true){$.get("http://ip-api.com/json",function(responseGeoIp){var location={coords:{latitude:responseGeoIp.lat,longitude:responseGeoIp.lon,accuracy:0,altitudeAccuracy:null,heading:null,speed:null},timestamp:null};_this.geoSuccess(location)},"json")}else{if(onError!==""){var errorMessage='code: '+error.code+'\n'+'message: '+error.message+'\n';onError(errorMessage)}}}};var GeoLocator=new GeoLoc();